<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Cat√°logo CG Balas</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<style>
    body {
        background: #000000;
        color: white;
        margin: 0;
        padding-top: 95px;
        padding-bottom: 70px;
        font-size: 1.1rem;
    }

    /* TOPO FIXO */
    .topo-fixo {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background: #1b1b1b;
        padding: 15px;
        z-index: 999;
        border-bottom: 2px solid #333;
    }

    /* RODAP√â FIXO */
    .rodape-fixo {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: #1b1b1b;
        padding: 12px;
        font-size: 1.2rem;
        text-align: center;
        font-weight: bold;
        border-top: 2px solid #333;
    }

    /* PRODUTOS */
    .produto-linha {
        display: flex;
        align-items: center;
        background: #1e1e1e;
        padding: 18px;
        border-radius: 14px;
        gap: 20px;
    }

    .produto-linha img {
        width: 110px;
        height: 110px;
        border-radius: 12px;
        object-fit: cover;
    }

    .produto-info h5 {
        font-size: 1.25rem;
        font-weight: bold;
        margin: 0;
    }

    .produto-info p {
        font-size: 1.15rem;
        margin: 3px 0;
        color: #ffdd55;
    }

    .indisponivel {
        color: #ff4444;
        font-weight: bold;
        font-size: 1rem;
    }

    .preco-zero {
        color: #ff4444;
        font-weight: bold;
        font-size: 1rem;
    }

    /* QUANTIDADE */
    .quantidade-area {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .quantidade-area input {
        width: 70px;
        font-size: 1.2rem;
        padding: 6px;
        text-align: center;
        height: 45px;
    }

    .btn-sm {
        font-size: 1.1rem !important;
        padding: 8px 14px !important;
    }

    button.btn-primary {
        font-size: 1.15rem !important;
        height: 45px;
        padding: 0 15px;
    }
</style>

<script>
    function addQuantidade(id, max){
        let campo = document.getElementById("qtd_" + id);
        let atual = parseInt(campo.value);
        if (atual < max) campo.value = atual + 1;
    }

    function subQuantidade(id){
        let campo = document.getElementById("qtd_" + id);
        if (campo.value > 1) campo.value = parseInt(campo.value) - 1;
    }

    function validarEstoque(id, max){
        let campo = document.getElementById("qtd_" + id);
        let v = parseInt(campo.value);
        if (v > max) campo.value = max;
        if (v < 1) campo.value = 1;
    }

    function adicionar(id){
        let qtd = document.getElementById("qtd_" + id).value;
        window.location.href = `/add/${id}/${qtd}/`;
    }
</script>

</head>

<body>

    <!-- TOPO FIXO -->
    <div class="topo-fixo">
        <div class="d-flex align-items-center">

            <!-- PESQUISA -->
            <form method="GET" style="flex-grow:1; margin-right: 15px;">
                <input type="text"
                       class="form-control"
                       style="font-size: 1.3rem; height: 55px; padding-left: 15px; border-radius: 12px;"
                       placeholder="Buscar..."
                       name="q"
                       value="{{ busca }}">
            </form>

            <!-- CARRINHO AO LADO -->
            <a href="{% url 'ver_carrinho' %}"
               class="btn btn-primary d-flex align-items-center justify-content-center"
               style="width: 60px; height: 55px; border-radius: 12px; font-size: 1.8rem;">
                üõí
            </a>

        </div>
    </div>

    <!-- LISTA DE PRODUTOS -->
    <div class="container py-3">

        <div class="d-flex flex-column" style="gap: 15px;">
            {% for p in produtos %}
            <div class="produto-linha">

                {% if p.imagem_url %}
                <img src="{{ p.imagem_url }}">
                {% endif %}

                <div class="produto-info">
                    <h5>{{ p.nome }}</h5>
                    <p>R$ {{ p.preco }}</p>

                    {% if p.preco <= 0 %}
                        <span class="preco-zero">‚ùå produto indisponivel</span>
                    {% elif p.estoque <= 0 %}
                        <span class="indisponivel">‚ùå Produto indispon√≠vel</span>
                    {% elif p.estoque <= 3 %}
                        <span class="text-warning">‚ö†Ô∏è √öltimas unidades!</span>
                    {% endif %}
                </div>

                {% if p.estoque > 0 and p.preco > 0 %}
                <div class="quantidade-area">
                    <button class="btn btn-danger btn-sm" onclick="subQuantidade({{ p.id }})">-</button>

                    <input 
                        type="number" 
                        id="qtd_{{ p.id }}" 
                        value="1" 
                        min="1" 
                        max="{{ p.estoque }}"
                        class="form-control form-control-sm"
                        oninput="validarEstoque({{ p.id }}, {{ p.estoque }})">

                    <button class="btn btn-success btn-sm" onclick="addQuantidade({{ p.id }}, {{ p.estoque }})">+</button>
                </div>

                <button class="btn btn-primary btn-sm"
                        onclick="adicionar({{ p.id }})">
                    ‚ûï
                </button>
                {% endif %}

            </div>
            {% endfor %}
        </div>
    </div>

    <!-- RODAP√â FIXO -->
    <div class="rodape-fixo">
        üü° Cat√°logo Oficial ‚Ä¢ CG BALAS
    </div>

</body>
</html>
